{% extends "layout/ChatbotLayout.html" %}
{% block content %}

    <div class="container-fluid" id="showData"></div>

    <script type="text/javascript">

        $(document).ready(function () {


            {#function showUser(userData, div){
                var col = Object.keys(userData[0]);
                var row = "";
                for(var i = 0; i < userData.length; i++){
                    row += "<div class = 'row'>";
                    row += "<div class='col-xs-2'></div>"; // will contain icons for update and delete row
                    row += "<div class='col-xs-2'>"+userData[i].username+"</div>";
                    row += "<div class='col-xs-2'>"+userData[i].name+"</div>";
                    row += "<div class='col-xs-2'>"+userData[i].role+"</div>";
                    row += "<div class='col-xs-4'>";
                    for(var j = 0; j < userData[i].access_json.length; j++){
                        row += "<div class = 'row'>";
                        row += "<div class='col-xs-3'>"+userData[i].access_json[j].col_name+"</div>";
                        row += "<div class='col-xs-3'>"+userData[i].access_json[j].operator_choice+"</div>";
                        row += "<div class='col-xs-6'>"+userData[i].access_json[j].value+"</div>";
                        row += "</div>";
                    }
                    row += "</div>";
                    row += '</div>';
                }
                console.log(row);
            }#}
            $.ajax({
                type: "GET",
                url: '/api/get_users',
                headers: {
                    "x-access-token": sessionStorage.getItem('accessToken')
                },
                success: function (response) {
                    userData = response;
                    var row = "";
                    row += "<div class = 'table-responsive container' style='padding-bottom:50px'><table class='table' ><tr>";
                    row += "<th>Update/Delete</th>"; // will contain icons for update and delete row
                    row += "<th>Username</th>";
                    row += "<th>Name</th>";
                    row += "<th>Role</th>";
                    row += '</tr>';

                    for (var i = 0; i < userData.length; i++) {
                        row += "<tr>";
                        if (userData[i].username != 'admin') {
                            row += "<td><button class='btn btn-info' onclick=\"UpdateUser('" + userData[i].username + "')\">Update</button><button class='btn btn-danger' onclick=\"DeleteUser('" + userData[i].username + "')\">Delete</button>" +
                                "</td>";
                        }
                        // will contain icons for update and delete row
                        else {
                            row += "<td></td>";
                        }
                        row += "<td>" + userData[i].username + "</td>";
                        row += "<td>" + userData[i].name + "</td>";
                        row += "<td>" + userData[i].role + "</td>";
                        row += '</tr>';
                    }
                    row += '</table></div>';
                    $('#showData').html(row);
                    {#var col = ['Username', 'Name', 'Role'];
                    #}{#for (var i = 0; i < userData.length; i++) {
                        for (var key in userData[i]) {
                            if (col.indexOf(key) === -1) {
                                col.push(key);
                            }
                        }
                    }#}{#

                    // CREATE DYNAMIC TABLE.
                    var table = document.createElement("table");

                    // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.

                    var tr = table.insertRow(-1);                   // TABLE ROW.

                    for (var i = 0; i < col.length; i++) {
                        var th = document.createElement("th");      // TABLE HEADER.
                        th.innerHTML = col[i];
                        tr.appendChild(th);
                    }

                    // ADD JSON DATA TO THE TABLE AS ROWS.
                    for (var i = 0; i < userData.length; i++) {
                        tr = table.insertRow(-1);
                        var tabCell = tr.insertCell(-1);
                        tabCell.innerHTML = userData[i].username;

                        tabCell = tr.insertCell(-1);
                        tabCell.innerHTML = userData[i].name;

                        tabCell = tr.insertCell(-1);
                        tabCell.innerHTML = userData[i].role;

                    }

                    // FINALLY ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
                    var divContainer = document.getElementById("showData");
                    divContainer.innerHTML = "";
                    divContainer.appendChild(table);#}


                }
            });


        });

        function UpdateUser(username) {

            window.location.href = '/UpdateUser/' + username;
            {#$.ajax({
                type: "POST",
                url: '/api/get_users',
                headers: {
                    "x-access-token": sessionStorage.getItem('accessToken')
                },
                data:JSON.stringify({"username": username}),
                success: function (response) {
                    userData = response;
                    #}{#$.ajax({
                        type: "POST",
                        url: '/UpdateUser',
                        data: userData
                    })#}{#
                    window.location.href = '/UpdateUser/'+username


                },
                error: function (error) {
                    alert(error)
                }
            });#}
        }

        function DeleteUser(username) {

            $.ajax({
                type: "GET",
                url: '/api/DeleteUser/' + username,
                headers: {
                    "x-access-token": sessionStorage.getItem('accessToken')
                },
                success: function (response) {
                    window.alert(response.message);
                    window.location.href = '/ViewUser';
                }
            });

        }
    </script>


{% endblock content %}